/*
Obsidian Bases Cards CSS Guide
https://github.com/EzraMarks/obsidian-bases-css-guide

This CSS enables advanced card layouts for Obsidian Bases using the "property packing" technique
and other techniques described in the README of the above repo.

Structure:
- Core Setup: Required CSS for property packing technique
- Starter Styles: Optional utility classes
- Example Implementation: CSS for the music library example

Conventions:
- Formula properties prefixed with "packed_" for packed properties
- Formula properties prefixed with "spacer_" for adding vertical space
- Link hrefs prefixed with "c:" (short for "classes") to act as CSS selectors
*/

/* ======== Core Setup (recommended for property packing technique) ======== */

/* Allow overflow so elements can use absolute positioning beyond card boundaries */
.bases-cards-property[data-property^="formula.packed"] .bases-cards-line,
.bases-cards-property[data-property^="formula.packed"] {
    overflow: visible;
}

/* Preserve normal formatting when packed properties appear in title position;
   without this, Obsidian would apply title-specific styles */
.bases-cards-property.mod-title[data-property^="formula.packed"] {
    --link-color: revert;
    --link-unresolved-color: revert;
    --link-unresolved-opacity: revert;
    --link-decoration: revert;
    --link-weight: revert;
    pointer-events: revert;
    font-weight: revert;
}

/* Remove link styling from all "c:" prefixed hrefs; we are using links to exploit the
   href attribute as a CSS selector, but we want the element to behave like a regular span */
.bases-cards-property[data-property^="formula.packed"] a[href^="c:"] {
    color: var(--text-normal);
    pointer-events: none;
    text-decoration: none;
}

/* Make spacer properties invisible; these properties are prefixed with the name "spacer"
   and only serve to add height to the card */
.bases-cards-property[data-property^="formula.spacer"] {
    display: none;
}

/* ======== Starter Styles (optional utility CSS) ======== */

.bases-cards-item {
    /* CSS variable, useful for absolute positioning from bottom of cover image */
    --bases-cards-bottom-offset: calc(var(--bases-cards-line-height) + 8px);
}

/* Theme-specific overlay colors for pills and tags; provides high contrast overlays
   that work in both light and dark themes */
.theme-light {
    --custom-bases-overlay-background-color: color-mix(in srgb, var(--text-normal) 70%, transparent);
    --custom-bases-overlay-text-color: var(--background-primary);
}

.theme-dark {
    --custom-bases-overlay-background-color: var(--background-primary);
    --custom-bases-overlay-text-color: var(--text-color);
}

/* image-overlay: position a container over the card's cover image (assuming square aspect ratio)
   Example usage: link("c: image-overlay", content) */
.bases-cards-property[data-property^="formula.packed"] a[href~="image-overlay"] {
    position: absolute;
    left: 0;
    bottom: var(--bases-cards-bottom-offset);
    display: flex;
    width: 100%;
    /* Matches square cards - change to match your card aspect ratio */
    aspect-ratio: 1;
}

/* align-top-left: align content to top-left corner
   Example usage: link("c: image-overlay align-top-left", content) */
.bases-cards-property[data-property^="formula.packed"] a[href~="align-top-left"] {
    display: flex;
    justify-content: flex-start;
    align-items: flex-start;
}

/* align-bottom-right: align content to bottom-right corner
   Example usage: link("c: image-overlay align-bottom-right", content) */
.bases-cards-property[data-property^="formula.packed"] a[href~="align-bottom-right"] {
    display: flex;
    justify-content: flex-end;
    align-items: flex-end;
}

/* stack-vertical: stack child elements vertically
   Example usage: link("c: stack-vertical", [item1, item2, item3]) */
.bases-cards-property[data-property^="formula.packed"] a[href~="stack-vertical"]>.value-list-container {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

/* gap-small: set small gap between child elements
   Example usage: link("c: stack-vertical gap-small", list) */
.bases-cards-property[data-property^="formula.packed"] a[href~="gap-small"]>.value-list-container {
    gap: var(--size-2-2);
}

/* gap-smaller: set smaller gap between child elements
   Example usage: link("c: stack-vertical gap-smaller", list) */
.bases-cards-property[data-property^="formula.packed"] a[href~="gap-smaller"]>.value-list-container {
    gap: var(--size-2-1);
}

/* margin-small: set small margin around element
   Example usage: link("c: pill margin-small", status) */
.bases-cards-property[data-property^="formula.packed"] a[href~="margin-small"] {
    margin: var(--size-2-3);
}

/* font-smaller: set font size to Obsidian smaller font
   Example usage: link("c: tag font-smaller", tagName) */
.bases-cards-property[data-property^="formula.packed"] a[href~="font-smaller"] {
    font-size: var(--font-smaller);
}


/* title: main card title with line wrap and ellipsis overflow
   Example usage: link("c: title", title) */
.bases-cards-property[data-property^="formula.packed"] a[href~="title"] {
    margin-bottom: var(--size-2-2);
    font-weight: calc(var(--font-weight) + var(--bold-modifier));
    color: var(--text-normal);
    font-size: 0.9em;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-wrap: pretty;
}

/* subtitle: card subtitle with ellipsis overflow
   Example usage: link("c: subtitle", artists) */
.bases-cards-property[data-property^="formula.packed"] a[href~="subtitle"] {
    font-size: var(--font-small);
    line-height: 2;
    display: block;
}

.bases-cards-property[data-property^="formula.packed"] a[href~="subtitle"] .value-list-container {
    overflow: hidden;
    text-overflow: ellipsis;
}

/* pill: rounded status pill
   Example usage: link("c: pill margin-small", status) */
.bases-cards-property[data-property^="formula.packed"] a[href~="pill"]:not(:empty) {
    padding: 4px 10px;
    background: var(--custom-bases-overlay-background-color);
    color: var(--custom-bases-overlay-text-color);
    font-weight: 600;
    border-radius: 9999px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    font-size: 0.9rem;
}

/* tag: rounded pill with accent coloring
   Example usage: tags.map(link("c: tag font-smaller", value) */
.bases-cards-property[data-property^="formula.packed"] a[href~="tag"] {
    display: inline-block;
    background-color: color-mix(in srgb, var(--color-accent-2) 56%, black 22%);
    color: color-mix(in srgb, var(--color-accent-2) 10%, white 100%);
    box-shadow: var(--shadow-s);
    border-radius: var(--tag-radius);
    padding: var(--tag-padding-y) var(--tag-padding-x);
}

/* ======== Example Implementation (styles specific to the Music Library example) ======== */

.bases-cards-property[data-property^="formula.packed"] a[href~="subtitle"] {
    width: calc(100% - 32px);
    /* Leave space for link icon */
}

/* link-icon: clickable link icon, positioned at the bottom right of the card
   Example usage: link("c: link-icon", link(your_url_property))
   Note that nested link pattern is required - outer link positions, inner link provides the URL */
.bases-cards-property[data-property^="formula.packed"] a[href~="link-icon"] a {
    pointer-events: auto;
    /* Re-enable clicking for this specific link */
    position: absolute;
    right: 8px;
    bottom: -46px;
    width: 18px;
    aspect-ratio: 1;
    background-color: var(--text-normal);
    color: var(--text-normal);
    mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>');
}

/* Title type icons - base style for folder-based icons */
.bases-cards-property[data-property^="formula.packed"] a[href~="title"][href*="folder-"]::before {
    display: inline-block;
    content: "";
    height: 1.1em;
    margin-right: var(--size-2-3);
    aspect-ratio: 1;
    background-color: var(--text-muted);
    mask-size: contain;
    mask-position: center;
    mask-repeat: no-repeat;
    vertical-align: middle;
    margin-top: -3px;
    /* Fine-tune alignment with text baseline */
}

/* Album icon - specific to folder path that contains "Music Library/Albums".
   Note that a better selector would be [href~="folder-Music Library/Albums"],
   but the following less-specific selector allows the example folder to be under any parent folder */
.bases-cards-property[data-property^="formula.packed"] a[href~="title"][href*="folder-"][href*="Music Library/Albums"]::before {
    mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-5.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"/></svg>');
}

/* Track icon - specific to folder path that contains "Music Library/Tracks" */
.bases-cards-property[data-property^="formula.packed"] a[href~="title"][href*="folder-"][href*="Music Library/Tracks"]::before {
    mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>');
}
